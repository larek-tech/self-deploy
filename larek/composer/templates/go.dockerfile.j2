# Build Stage
FROM golang:{{ service.lang.version or "1.21" }}-alpine AS builder

WORKDIR /app

{% if service.dependencies.packet_manager == "go mod" %}
# Copy go.mod and optionally go.sum if dependencies exist
COPY go.mod ./
{% if service.dependencies.libs|length > 0 %}
COPY go.sum ./
RUN go mod download
{% endif %}
{% endif %}

COPY . .

# Build the application
RUN go build -o /bin/{{ service.name }} {{ service.entrypoint }}

# Final Stage
FROM alpine:latest

WORKDIR /app
COPY --from=builder /bin/{{ service.name }} /app/{{ service.name }}

CMD ["/app/{{ service.name }}"]
