# Build Stage
FROM node:{{ node_version }}-alpine AS builder

WORKDIR /app

COPY package.json {% if package_manager == 'yarn' %}yarn.lock{% elif package_manager == 'pnpm' %}pnpm-lock.yaml{% else %}package-lock.json{% endif %} ./

RUN {{ package_manager }} install

COPY . .

RUN {{ package_manager }} run build

# Serve Stage
FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
# Optional: Copy custom nginx config if exists
# COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
