# Инициализация проекта (`larek init`) — шаги и артефакты

Команда `larek init` (файл: `larek/commands/init.py`) выполняет полную инициализацию проекта: клонирование репозитория, анализ структуры, генерацию Dockerfile и пайплайна, а также пуш в GitLab.

## Общий сценарий

Входные параметры команды:
- `repo_url` — URL репозитория (git)
- `--branch` / `-b` — ветка для клонирования (по умолчанию `main`)

Шаги (последовательность реализации в `init.py`):

1. clone_step(repo_url, branch)
   - Клонирует репозиторий в локальную директорию.
   - Если текущая директория уже является репозиторием с remote origin, может использовать её.
   - Выход: локальная копия проекта (путь `.` или `repo_name`).

2. analyze(repo_path)
   - Создаёт объект `RepoAnalyzer`, регистрирует анализаторы для языков (Go, Java, Kotlin, JavaScript, Python).
   - Запускает анализ структуры репозитория и собирает `RepoSchema`.
   - Сохраняет результат в файл: `.larek/build.yaml`.

3. docker(repo_path)
   - Читает `.larek/build.yaml`.
   - Для каждого сервиса из `RepoSchema.services` вызывает `Composer.get_dockerfile` и записывает результат в `.larek/{service.name}.Dockerfile`.
   - Пропускает Android-проекты, если Dockerfile не нужен.

4. gitlab_step(repo_path)
   - Читает `.larek/build.yaml`.
   - Использует `PipelineComposer` для генерации `.gitlab-ci.yml` и записывает его в корень проекта.

5. push_to_gitlab(repo_path)
   - Получает аутентифицированный клиент GitLab (см. `larek/utils/gitlab_auth.py`).
   - Пытается найти существующий проект по имени/путям.
   - Если проект не найден — создаёт новый проект (до 3 попыток с суффиксами при совпадении имён).
   - Настраивает remote `gitlab` с SSH URL проекта и пушит ветку `ci`.
   - Возвращает пользователя на предыдущую ветку (если было переключение).

## Какие файлы генерируются

- `.larek/build.yaml` — схема репозитория (RepoSchema), создаётся в шаге `analyze`.
- `.larek/{service.name}.Dockerfile` — Dockerfile'ы для сервисов (если применимо).
- `.gitlab-ci.yml` — CI/CD pipeline, сгенерирован из шаблонов pipeliner.

## Типичные ошибки и как их диагностировать

- Ошибка: файл `.larek/build.yaml` не найден — причина: analyze не сработал или неправильный рабочий каталог. Проверьте вывод команды и `os.getcwd()`.
- Ошибка: не удалось создать проект на GitLab — проверьте токен и права (нужны `api`, `create_project`, `write_repository`).
- Ошибка: push не удался — проверьте доступ по SSH и настройки remote.


